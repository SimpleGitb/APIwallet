<!DOCTYPE html>
  <html>
  <head>
      <meta charset="utf-8">
      <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
      <title>title</title>
      <link rel="stylesheet" type="text/css" href="../css/api.css"/>
      <style>
          html{
            /*background: url("../image/bg.png");*/
            background: url("../image/Bitmap.png");
            background-size: 100% 100%;
            background-repeat: no-repeat;
            color: #fff;
            height: 100%
          }
          body{
            width: 100%;
            background: none;
            font-size: .16rem;
          }
          .row{ margin-top: 1.3rem; margin-left: 16.26%;}
          .row1{ margin-top: .22rem;margin-left: 22.4%;}
          .row2{ margin-top: .14rem; margin-left: 39.46%;}
          .address_w{
            margin-top: 26px;
            width: 100%;
            height: 154px;
            text-align: center;;
          }
          .wrap_head{
            width:154px;
            height:154px;
            margin: auto;;
            background: #fff;
            border-radius: .1rem;
            display: flex;
            justify-content: center;
            align-items: center;
          }
          .wrap_title{font-size:.18rem; margin: .77rem .15rem 0 .15rem;height: .45rem; line-height: .45rem; text-align: center; background: #376AFC;  color: #fff;  border-radius: .06rem;}
          .aiBrand{
            margin: auto;
            margin-top: 25px;
            display: block;
          }
          .personT{
            margin: auto;
            margin-top: 10px;
            display: block;
            z-index: 10;
          }
          .coverbox{
            width: 86%;
            position: absolute;
            margin: auto;
            margin-top: -37px;
            margin-left: 6%;
            display: block;
            z-index: -1;
            box-shadow: 3px 0 0 #FFFFFF;
          }
          .invateTitle{
            margin-top: 10px;
            text-align: center;
            color: #376AFC;
            font-size: 18px;
            font-weight: bold;
          }
          #saveImg {
            position: absolute;
            border: 1px solid #00f;
            top: 0;
            /*width:80%;
            height: 60%;
            margin-top: -50px;*/
            opacity: 0;
          }
          #invateCode{
            word-wrap: break-word;
          }
          .copyArticle{
            color:#63A6F2;display:inline-block;width:49px;height:20px;background:#F6F7F8;line-height: 20px;border-radius: 5px;font-weight: normal;
          }
      </style>
  </head>
  <body>
    <div class="wrap">
      <img src="../image/aititle.png" alt="" class="aiBrand">
      <img src="../image/person.png" alt="" class="personT">
      <img src="../image/coverbox.png" alt="" class="coverbox">
      <div class="invateTitle">
        我的邀请码
      </div>
      <div class="invateTitle">
        <span id="invateCode"></span> <span onclick="copyArticle()" class="copyArticle">复制</span>
      </div>
      <!-- <div class="row">推广期间通过邀请好友加入乐骐AI工厂</div>
      <div class="row1">我们将同时赠送您和您的好友</div>
      <div class="row2">丰厚的礼品</div> -->
      <div class="address_w" id="cbox">
        <div class="wrap_head img-thumbnail" id="wrap_head"></div>
      </div>
      <div class="invateTitle" style="color:#313546;font-size:12px;margin-top:22px;">
        长按二维码下载AI工场APP
      </div>
      <!-- <img id="saveImg" alt="" src=""> -->
      <!-- <div class="wrap_title" onclick="share()">点击分享</div> -->
    </div>
  </body>
  <script type="text/javascript" src="../script/api.js"></script>
  <script src="../script/common.js"></script>
  <script src="../script/qrcode.js"></script>
   <script src="../script/html2canvas.min.js"></script>
  <script type="text/javascript">
      var address,loadUrl;
      apiready = function(){
        address = $api.getStorage('userInfo');
        loadUrl = $api.getStorage('loadUrl');
        if(address.invitationCode){
          $api.dom('#invateCode').innerHTML = address.invitationCode;
        }else {
          $api.dom('#invateCode').innerHTML = 00000;
        }
        // console.log(JSON.stringify(loadUrl));
        var qrcode = new QRCode(document.getElementById("wrap_head"), {
            width : 154,//设置宽高
            height : 154
        });
        qrcode.makeCode(loadUrl);
        api.addEventListener({
            name:'longpress'
          }, function(ret, err){
            console.log("长按")
            var el = document.getElementById("wrap_head");
            var saveImg = document.getElementById("saveImg");
            var canvas = document.createElement("canvas");
            var scale = window.devicePixelRatio;
            var ctx=canvas.getContext("2d")
            var rect = el.getBoundingClientRect();  //获取元素相对于视察的偏移量
            var w = el.offsetWidth;
            var h = el.offsetHeight;
            canvas.width = w * scale;
            canvas.height = h * scale;
            canvas.style.width = w ;
            canvas.style.height = h ;
            ctx.scale(scale, scale);
            ctx.translate(-rect.left,-rect.top);    //设置context位置，值为相对于视窗的偏移量负值，让图片复位
            html2canvas(el, {
              scale: scale,
              canvas: canvas,
              width: w,
              height: h,
              logging: false,
              background: "#f2f2f2",
              useCORS: true
            }).then(function (canvas) {
              var dataUrl = canvas.toDataURL("jpeg");
              console.log(canvas);
              console.log(dataUrl);
              // saveImg.src=dataUrl;
            });
          });

      };
      function share() {
        api.openFrame({
            name: 'selectShare',
            url: './SelectShare.html',
            rect: {
                x: 0,
                y: 0,
                w: api.winWidth,
                h: api.winHeight
            },
            bounces: false,
        });
      };
      function copyArticle(event) {    
        var text =document.getElementById("invateCode").innerText;
        var input = document.createElement('input');
        input.setAttribute('id', 'copyInput');
        input.setAttribute('value', text);
        document.getElementsByTagName('body')[0].appendChild(input);
        document.getElementById('copyInput').select();
        if (document.execCommand('copy')) {
            api.toast({ msg: '已复制' });
        }
        document.getElementById('copyInput').remove();
		}
  </script>
  </html>
